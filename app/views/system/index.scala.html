@(currentUser: org.graylog2.restclient.models.User,
        jobs: List[org.graylog2.restclient.models.SystemJob],
        clusterHealth: org.graylog2.restclient.models.ESClusterHealth,
        systemMessages: List[org.graylog2.restclient.models.SystemMessage],
        totalSystemMessages: Integer,
        page: Integer,
        notifications: List[lib.notifications.NotificationType],
        indexFailureCount: Long,
        masterTimeZone: String)
@import org.graylog2.restclient.models._
@import lib.security.RestPermissions._
@import views.helpers.Permissions._
@import views.helpers.DateHelper

@main("System", views.html.system.sidebar(), "", currentUser, false) {

    <div class="row content content-head">
        <div class="col-md-10">
            <h1>System overview</h1>

            <p class="description">
                wahwahwah
            </p>

        </div>
    </div>

    <div class="row content">
        <div class="col-md-12">
            @if(isPermitted(NOTIFICATIONS_READ)) {
                <h2>
                    @if(notifications != null && !notifications.isEmpty) {
                        @if(notifications.size == 1) {
                            There is 1 notification
                        } else {
                            There are @notifications.size() notifications
                        }
                    } else {
                        No notifications
                    }
                </h2>

                <p class="description">
                    Notifications are triggered by Graylog and indicate a situation you should act upon. Many notification
                    types will also provide a link to the Graylog documentation if you need more information or assistance.
                </p>

                @for(notification <- notifications) {
                    <div class="notification alert alert-danger">
                        @if(notification.isCloseable() && isPermitted(NOTIFICATIONS_DELETE)) {
                            <button type="button" class="close delete-notification" data-notificationtype="@notification.getNotification.getType().toString().toLowerCase()">&times;</button>
                        }

                        <h3 class="notification-head">
                            <i class="fa fa-bolt"></i>
                            @notification.getTitle

                            <span class="notification-timestamp">
                                (triggered @DateHelper.readablePeriodFromNow(notification.getNotification.getTimestamp))
                            </span>
                        </h3>

                        <div class="notification-description">
                            @Html(notification.getDescription)
                        </div>
                    </div>
                }

                @if(notifications.isEmpty) {
                    <div class="alert alert-info notifications-none">
                        <i class="fa fa-check-circle"></i>
                        &nbsp;No notifications
                    </div>
                }
            }
        </div>
    </div>

    <div class="row content">
        <div class="col-md-12">
            @if(isPermitted(SYSTEMJOBS_READ)) {
                <div class="row-fluid">
                    <h2>System jobs</h2>

                    <p class="description">
                        A system job is a long-running task a graylog-server node executes for maintenance reasons. Some jobs
                        provide progress information or can be stopped.
                    </p>

                    @for(job <- jobs) {
                        <div class="systemjob systemjob-progress systemjob-active" id="job-@job.getId()" data-job-id="@job.getId()">
                            <i class="icon icon-cog"></i>
                            Started @job.getName
                            on @partials.links.to_node(job.getNode)
                            at @DateHelper.timestampShortTZ(job.getStartedAt())

                            <span class="label label-success finished">Finished!</span>

                            <div class="progress">
                                <div class="progress-bar progress-bar-info active" role="progressbar" style="width: @job.getPercentComplete()%;">
                                    @job.getPercentComplete()%
                                </div>
                            </div>
                        </div>
                    }

                    @if(jobs.isEmpty) {
                        <div class="alert alert-info systemjobs-none">
                            <i class="fa fa-info-circle"></i>
                            &nbsp;No active system jobs.
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    <!--
    @if(isPermitted(INDEXERCLUSTER_READ)) {
        <div class="row-fluid">
            @partials.support.head_bubble("general/elasticsearch-cluster-status-explained")
            <h2><i class="icon icon-tasks"></i> Elasticsearch cluster</h2>

            @views.html.partials.es_cluster_health.render(clusterHealth)
        </div>
    }

    @if(isPermitted(INDICES_FAILURES)) {
        <div class="row-fluid">
            @partials.support.head_bubble("general/indexerfailures")
            <h2><i class="icon icon-truck"></i> Indexer failures</h2>

            @views.html.partials.indexer_failures.render(indexFailureCount)
        </div>
    }

    <div class="row-fluid">
        <h2><i class="icon icon-time"></i> Time configuration</h2>

        @views.html.partials.dates.time_configuration.render(currentUser, masterTimeZone)
    </div>

    @if(isPermitted(SYSTEMMESSAGES_READ)) {
        <div class="row-fluid">
            <h2><i class="icon icon-comments-alt"></i> System messages</h2>

            <table class="system-messages table table-striped table-hover table-condensed">
                <thead>
                    <tr>
                        <th style="width: 170px;">Timestamp</th>
                        <th>Node</th>
                        <th>Message</th>
                    </tr>
                </thead>

                <tbody>
                    @for(message <- systemMessages) {
                        <tr>
                            <td>@DateHelper.timestampShortTZ(message.getTimestamp)</td>
                            <td>
                                <a href="@routes.NodesController.node(message.getNodeId)">
                                    @message.getNodeId
                                </a>
                            </td>
                            <td>@message.getContent</td>
                        </tr>
                    }
                </tbody>

            </table>

            @partials.paginator(page, SystemMessage.PER_PAGE, totalSystemMessages, routes.SystemController.index(_))
        </div>
    }
    -->
}
