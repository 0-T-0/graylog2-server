@(currentUser: org.graylog2.restclient.models.User,
    breadcrumbs: lib.BreadcrumbList,
    outputs: List[org.graylog2.restclient.models.Output],
    otherOutputs: List[org.graylog2.restclient.models.Output],
    stream: org.graylog2.restclient.models.Stream,
    availableOutputs: Map[String, org.graylog2.restclient.models.api.responses.AvailableOutputSummary])

@import views.helpers.Permissions
@import lib.security.RestPermissions._;
@import views.helpers.Permissions._;

@main("Outputs of stream \"" + stream.getTitle + "\"", null, "", currentUser, false) {

    <div class="row content content-header">
        <div class="col-md-12">
            <h1>
                <i class="fa fa-download"></i>
                Outputs for Stream &raquo;@stream.getTitle&laquo;
            </h1>
            <p class="description">
                Graylog nodes can forward messages of streams via outputs. Launch or terminate as many outputs as you want here.
                You can also reuse outputs that are already running for other streams.

                A global view of all configured outputs is available <a href="@routes.OutputsController.index()">here</a>.
                You can find output plugins on <a href="https://www.graylog.org/resources/integrations/" target="_blank">the Graylog website</a>.

                <br /><br />
                <i>Removing</i> an output removes it from this stream but it will still be in the list of available outputs.
                You can terminate a stream in the <a href="@routes.OutputsController.index()">global output list</a>.
            </p>
        </div>
    </div>

    <div class="row content">
        <div class="col-md-12">
            @if(isPermitted(OUTPUTS_CREATE)) {
                <div class="output-new">
                    <form class="form-inline">
                        <select id="input-type" class="form-control">
                            <option selected disabled>Select type of new output</option>
                        @for((inputType,info) <- availableOutputs.toSeq.sortBy(_._2.name)) {
                            <option value="@inputType">@info.name</option>
                        }
                        </select>
                        <button id="configure-input" type="button" class="btn btn-success form-control">Launch new Output</button>
                    </form>
                </div>

                @views.html.system.outputs.partials.output_creation_forms.render(availableOutputs, routes.StreamOutputsController.create(stream.getId))
            }
            @if(isPermitted(STREAM_OUTPUTS_CREATE) && otherOutputs.size > 0) {
                <div class="output-add" style="margin-top: 10px">
                    <form class="form-inline" action="@routes.StreamOutputsController.add(stream.getId)" method="POST">
                        <select name="outputId" class="form-control">
                            @if(otherOutputs.size > 0) {
                                <option selected disabled>Select existing output</option>
                                @for(output <- otherOutputs.toSeq.sortBy(_.getTitle)) {
                                    <option value="@output.getId">@output.getTitle</option>
                                }
                            } else {
                                <option disabled>No outputs available</option>
                            }
                        </select>

                        <button type="submit" id="add-existing-output" class="btn btn-success form-control">Assign existing Output</button>
                    </form>
                </div>
            }

        </div>
    </div>
    <div class="row content">
        <div class="col-md-12">
            <h2><i class="fa fa-cogs"></i> Configured outputs</h2>
            <div class="outputs-list" id="react-output-list" data-permissions="@Permissions.asJson(STREAM_OUTPUTS_DELETE, OUTPUTS_TERMINATE, OUTPUTS_EDIT)" data-stream-id="@stream.getId">
            </div>
        </div>
    </div>
}
